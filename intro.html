<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>第 1 章 Webx总体介绍</title><link rel="stylesheet" type="text/css" href="docbook.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"/><link rel="home" href="index.html" title="Webx框架指南"/><link rel="up" href="pt01.html" title="部分 I. Webx框架概览"/><link rel="prev" href="pt01.html" title="部分 I. Webx框架概览"/><link rel="next" href="springext.html" title="第 2 章 SpringExt"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 1 章 Webx总体介绍</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="pt01.html">上一页</a> </td><th width="60%" align="center">部分 I. Webx框架概览</th><td width="20%" align="right"> <a accesskey="n" href="springext.html">下一页</a></td></tr></table><hr/></div><div xml:lang="zh-CN" class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="webx.overview.intro"><!--anchor webx.overview.intro--></a>第 1 章 Webx总体介绍</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="intro.html#d0e157">1.1. 设计理念</a></span></dt><dd><dl><dt><span class="section"><a href="intro.html#d0e160">1.1.1. 框架的本质</a></span></dt><dt><span class="section"><a href="intro.html#d0e210">1.1.2. 基础框架</a></span></dt><dt><span class="section"><a href="intro.html#d0e236">1.1.3. 层次化</a></span></dt></dl></dd><dt><span class="section"><a href="intro.html#d0e289">1.2. Webx的层次</a></span></dt><dd><dl><dt><span class="section"><a href="intro.html#d0e292">1.2.1. 三个大层次</a></span></dt><dt><span class="section"><a href="intro.html#d0e318">1.2.2. 剪裁和定制Webx</a></span></dt></dl></dd><dt><span class="section"><a href="intro.html#d0e430">1.3. 本章总结</a></span></dt></dl></div><p>本章概要地介绍了Webx框架的整体结构和设计。如果你想了解更多，请参考其它详细文档。</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d0e157"><!--anchor d0e157--></a>1.1. 设计理念</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e160"><!--anchor d0e160--></a>1.1.1. 框架的本质</h3></div></div></div><div class="figure"><a id="framework-structure"><!--anchor framework-structure--></a><div class="figure-contents"><div class="mediaobject"><img src="images/o1/framework.png" alt="框架结构的建筑"/></div></div><p class="title"><strong>图 1.1. 框架结构的建筑</strong></p></div><p>应用框架（Application Framework），让人联想到建筑的框架（Frame Structure）。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>建筑框架确定了整个建筑的结构；应用框架确定了应用的结构。</p></li><li class="listitem"><p>建筑框架允许你在不改变结构的基础上，自由改变其内容。例如，你可以用墙体随意分隔房间。应用框架允许你在不改变整体结构的基础上，自由扩展功能。</p></li></ul></div><p>可以这样说，框架的本质就是“扩展”。维基百科这样定义描写“软件框架”，它说一个软件框架必须符合如下要素：</p><div class="informaltable"><table cellpadding="10" style="border-collapse: collapse;border-top: 0.5pt solid #6666cc; border-bottom: 0.5pt solid #6666cc; border-left: 0.5pt solid #6666cc; border-right: 0.5pt solid #6666cc; "><colgroup><col width="50%" class="c1"/><col width="50%" class="c2"/></colgroup><tbody><tr><td style="">Inversion of Control 反转控制</td><td style="">应用的流程不是由应用控制的，而是由框架控制的。</td></tr><tr><td style="">Default Behavior 默认行为</td><td style="">框架会定义一系列默认的行为。</td></tr><tr><td style="">Extensibility 扩展性</td><td style="">应用可以扩展框架的功能，也可以修改框架的默认行为。</td></tr><tr><td style="">Non-modifiable Framework Code 框架本身不可更改</td><td style="">框架在被扩展时，自身的代码无须被改变。</td></tr></tbody></table></div><p>在一个框架中，实现丰富的功能固然重要，然而更重要的是：<span class="emphasis"><em>建立良好的扩展机制</em></span>。我们知道，Webx目前虽然欠缺一些流行的功能。然而Webx却有一个良好的扩展机制，来支持开发者增加新的功能。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e210"><!--anchor d0e210--></a>1.1.2. 基础框架</h3></div></div></div><p>纵观开源的Web框架，做得比较好的框架，都有一个共性 —— 它们并不是简单地实现Web应用所需要的功能（诸如Action、模板、表单验证等），而是把框架建立在另一个基础框架之上。这个基础框架的作用是：组装模块；提供扩展机制。建立在这种基础上的Web框架有很好的适应性和扩展性，可以应对Web应用不断变化和发展的需求。</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>早期的Turbine，建立在Service框架之上。</p></li><li class="listitem"><p>Webwork，建立在Xwork框架之上。</p></li><li class="listitem"><p>Tapestry，建立在HiveMind或Tapestry IOC框架之上。</p></li><li class="listitem"><p>早期的Struts 1.x由于没有一个轻量框架作为基础，因此很难扩展。而Struts
                            2.x使用了Webwork和Xwork，因此适用能力大为提高。</p></li><li class="listitem"><p>Spring MVC，建立在Spring框架之上。</p></li></ul></div><p><span class="emphasis"><em>一个Web框架的好坏，往往不是由它所实现的具体功能的好坏决定的，而是由其所用的基础框架的好坏决定的。</em></span></p><p>Webx建立在SpringExt的基础上 ——
                SpringExt是对Spring的扩展。Spring是当今主流的轻量级框架。SpringExt没有损失任何Spring的功能，但它能够提供比Spring自身更强大的扩展能力。</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e236"><!--anchor d0e236--></a>1.1.3. 层次化</h3></div></div></div><p><span class="emphasis"><em>设计良好的模块，应该是层次化的。</em></span></p><p>例如，模块B扩展了模块A，同时被模块C扩展。这样就形成了A、B、C三个层次。</p><div class="figure"><a id="tiers"><!--anchor tiers--></a><div class="figure-contents"><div class="mediaobject"><img src="images/o1/tiers.png" alt="模块的层次"/></div></div><p class="title"><strong>图 1.2. 模块的层次</strong></p></div><p>如图所示，层次之间有如下的关系：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>上层定义规则，下层定义细节；（上层、下层也可称为内层、外层）</p></li><li class="listitem"><p>上层是抽象的，下层是具体的；</p></li><li class="listitem"><p>越上层，越稳定（越少改变）；越下层，越易变。</p></li><li class="listitem"><p>依赖倒转（Dependency Inversion）。下层（具体）依赖上层（抽象），而不是上层依赖下层。</p></li><li class="listitem"><p>下层扩展上层时，不需要修改到上层的任何代码和配置。即符合开闭原则（Open-Closed Principle简称OCP – Open for
                            extension, Closed for modification）。</p></li><li class="listitem"><p>每一层均可被替换。 </p></li></ul></div><p>层次化的设计，使软件中的每一个部分都可被增强或替换。</p><p><span class="emphasis"><em>层次化不是自然而然的，而是需要精心的设计。</em></span>设计一个层次化的组件，可以从下面几方面来考虑：</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>切分功能。每个组件专心做一件事。</p></li><li class="listitem"><p>分析哪些会改变，哪些不会改变。不变部分固化在组件中，可能会改变的部分抽象成接口，以便扩展。</p></li><li class="listitem"><p>考虑默认值和默认扩展。默认值和默认扩展应该是最安全、最常用的选择。对于默认值和默认扩展，用户在使用时不需要额外的配置。</p></li></ul></div><p>Webx鼓励层次化的模块设计，而SpringExt提供了创建和配置层次化组件的机制。</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d0e289"><!--anchor d0e289--></a>1.2. Webx的层次</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e292"><!--anchor d0e292--></a>1.2.1. 三个大层次</h3></div></div></div><p>很多用过Webx框架的人说起Webx，就想到：Webx如何处理页面、如何验证表单、如何渲染模板等等功能。事实上，这些只不过是Webx最外层、最易变、非本质的功能。</p><p>Webx框架不仅鼓励层次化设计，它本身也是层次化的。<span class="emphasis"><em>你既可以使用全部的Webx框架，也可以只使用部分的Webx框架。</em></span>大体上，Webx框架可以划分成三个大层次，如图所示。</p><div class="figure"><a id="webx-tiers"><!--anchor webx-tiers--></a><div class="figure-contents"><div class="mediaobject"><img src="images/o1/webx-tiers.png" alt="Webx的层次"/></div></div><p class="title"><strong>图 1.3. Webx的层次</strong></p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>SpringExt：基于Spring，提供扩展组件的能力。它是整个框架的基础。</p></li><li class="listitem"><p>Webx Framework：基于Servlet
                        API，提供基础的服务，例如：初始化Spring、初始化日志、接收请求、错误处理、开发模式等。Webx
                        Framework只和servlet及spring相关 ——
                        它不关心Web框架中常见的一些服务，例如Action处理、表单处理、模板渲染等。因此，事实上，你可以用Webx
                        Framework来创建多种风格的Web框架。</p></li><li class="listitem"><p>Webx Turbine：基于Webx Framework，实现具体的网页功能，例如：Action处理、表单处理、模板渲染等。</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="d0e318"><!--anchor d0e318--></a>1.2.2. 剪裁和定制Webx</h3></div></div></div><p>并非所有的开发者都需要使用Webx的全部。下面列举几种情形。</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="d0e323"><!--anchor d0e323--></a>1.2.2.1. 级别一：仅使用SpringExt，适用于非Web应用、单元测试</h4></div></div></div><p>对于非Web应用和单元测试，但却想拥有Spring和SpringExt的功能，可以直接创建SpringExt容器：</p><div class="example"><a id="d0e328"><!--anchor d0e328--></a><p class="title"><strong>例 1.1. 直接创建SpringExt容器</strong></p><div class="example-contents"><pre class="programlisting"><strong class="hl-keyword" style="color: maroon">import</strong> java.io.File;
<strong class="hl-keyword" style="color: maroon">import</strong> org.springframework.core.io.FileSystemResource;
<strong class="hl-keyword" style="color: maroon">import</strong> com.alibaba.citrus.springext.support.context.XmlApplicationContext; <a id="co.xac"><!--anchor co.xac--></a><span class="calloutno"><img src="images/callouts/1.png" border="0"/></span>

...

XmlApplicationContext parentContext = <strong class="hl-keyword" style="color: maroon">new</strong> XmlApplicationContext(
        <strong class="hl-keyword" style="color: maroon">new</strong> FileSystemResource(<strong class="hl-keyword" style="color: maroon">new</strong> File(srcdir, <strong class="hl-string"><em style="color:navy">"parent.xml"</em></strong>)));  <a id="co.xac.normal"><!--anchor co.xac.normal--></a><span class="calloutno"><img src="images/callouts/2.png" border="0"/></span>

XmlApplicationContext context = <strong class="hl-keyword" style="color: maroon">new</strong> XmlApplicationContext(
        <strong class="hl-keyword" style="color: maroon">new</strong> FileSystemResource(<strong class="hl-keyword" style="color: maroon">new</strong> File(srcdir, <strong class="hl-string"><em style="color:navy">"app.xml"</em></strong>)), parentContext); <a id="co.xac.w.parent"><!--anchor co.xac.w.parent--></a><span class="calloutno"><img src="images/callouts/3.png" border="0"/></span>

Object mybean = context.getBean(<strong class="hl-string"><em style="color:navy">"mybean"</em></strong>);</pre></div></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.xac"><span class="calloutno"><img src="images/callouts/1.png" border="0"/></span></a> </p></td><td valign="top" align="left"><p>请注意代码所使用的<code class="code">ApplicationContext</code>实现类为SpringExt扩展的类型（<code class="code">c.a.c.springext.s.c.XmlApplicationContext</code>）。通过这个实现类，你除了可以使用原来Spring的所有功能以外，还可以使用SpringExt的所有功能，包括：Schema、Configuration
                            Points和Contributions、ResourceLoadingService等。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.xac.normal"><span class="calloutno"><img src="images/callouts/2.png" border="0"/></span></a> </p></td><td valign="top" align="left"><p>这行代码从一个配置文件中创建容器。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.xac.w.parent"><span class="calloutno"><img src="images/callouts/3.png" border="0"/></span></a> </p></td><td valign="top" align="left"><p>这行代码创建了一个子容器。多个子容器和父容器之间可组成一个树状级联的容器结构。在子容器中可以访问到所有父容器中的beans和服务，但反过来是不成立的。</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="d0e355"><!--anchor d0e355--></a>1.2.2.2. 级别二：仅使用SpringExt及Web组件，在此基础上运行Spring MVC、Struts等非webx框架</h4></div></div></div><p>非webx框架也可以使用SpringExt的全部功能。</p><div class="example"><a id="d0e360"><!--anchor d0e360--></a><p class="title"><strong>例 1.2. 修改<code class="filename">/WEB-INF/web.xml</code>，让非webx框架支持SpringExt</strong></p><div class="example-contents"><pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;web-app</strong> <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"2.4"</span> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://java.sun.com/xml/ns/j2ee"</span>
    <span class="hl-attribute" style="color: #F5844C">xmlns:xsi</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute" style="color: #F5844C">xsi:schemaLocation</span>=<span class="hl-value" style="color: #993300">"
        http://java.sun.com/xml/ns/j2ee  http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd
    "</span><strong class="hl-tag" style="color: #000096">&gt;</strong>

    <em class="hl-comment" style="color: green">&lt;!-- 初始化日志系统，装载/WEB-INF/log4j.xml或/WEB-INF/logback.xml --&gt;</em>
    <strong class="hl-tag" style="color: #000096">&lt;listener&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;listener-class&gt;</strong>com.alibaba.citrus.logconfig.LogConfiguratorListener<strong class="hl-tag" style="color: #000096">&lt;/listener-class&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/listener&gt;</strong>

    <em class="hl-comment" style="color: green">&lt;!-- 初始化Spring容器，装载/WEB-INF/webx.xml, /WEB-INF/webx-*.xml --&gt;</em>
    <strong class="hl-tag" style="color: #000096">&lt;listener&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;listener-class&gt;</strong>com.alibaba.citrus.webx.context.WebxContextLoaderListener<strong class="hl-tag" style="color: #000096">&lt;/listener-class&gt;</strong> <a id="co.context-loader"><!--anchor co.context-loader--></a><span class="calloutno"><img src="images/callouts/1.png" border="0"/></span>
    <strong class="hl-tag" style="color: #000096">&lt;/listener&gt;</strong>

    <em class="hl-comment" style="color: green">&lt;!-- 下面配置：Spring MVC、Struts的filter、servlet、mapping... --&gt;</em>
    ……

<strong class="hl-tag" style="color: #000096">&lt;/web-app&gt;</strong></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.context-loader"><span class="calloutno"><img src="images/callouts/1.png" border="0"/></span></a> </p></td><td valign="top" align="left"><p>这里使用了webx的<code class="code">WebxContextLoaderListener</code>来初始化spring容器，而不是用spring原生的<code class="code">ContextLoaderListener</code>。不用担心，前者完全兼容后者。事实上前者是从后者派生而来的。</p></td></tr></table></div></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="d0e380"><!--anchor d0e380--></a>1.2.2.3. 级别三：仅使用Webx Framework，创造新的Web框架</h4></div></div></div><p>也许你想做一个新的Web框架 —— 因为你并不想使用Webx Turbine中提供的页面处理的方案，但你仍然可以使用Webx
                    Framework所提供的服务，例如：错误处理、开发模式等。</p><div class="example"><a id="d0e385"><!--anchor d0e385--></a><p class="title"><strong>例 1.3. 修改<code class="filename">/WEB-INF/webx.xml</code>，以创建新的WEB框架</strong></p><div class="example-contents"><pre class="programlisting"><strong class="hl-tag" style="color: #000096">&lt;webx-configuration</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://www.alibaba.com/schema/services"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;components</strong> <span class="hl-attribute" style="color: #F5844C">defaultControllerClass</span>=<span class="hl-value" style="color: #993300">"com.myframework.MyController"</span><strong class="hl-tag" style="color: #000096">&gt;</strong> <a id="co.controller"><!--anchor co.controller--></a><span class="calloutno"><img src="images/callouts/1.png" border="0"/></span>
        <strong class="hl-tag" style="color: #000096">&lt;rootController</strong> <span class="hl-attribute" style="color: #F5844C">class</span>=<span class="hl-value" style="color: #993300">"com.myframework.MyRootController"</span><strong class="hl-tag" style="color: #000096"> /&gt;</strong> <a id="co.root-controller"><!--anchor co.root-controller--></a><span class="calloutno"><img src="images/callouts/2.png" border="0"/></span>
    <strong class="hl-tag" style="color: #000096">&lt;/components&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/webx-configuration&gt;</strong></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.controller"><span class="calloutno"><img src="images/callouts/1.png" border="0"/></span></a> </p></td><td valign="top" align="left"><p><code class="code">MyController</code>扩展了<code class="code">AbstractWebxController</code>。</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.root-controller"><span class="calloutno"><img src="images/callouts/2.png" border="0"/></span></a> </p></td><td valign="top" align="left"><p><code class="code">MyRootController</code>扩展了<code class="code">AbstractWebxRootController</code>。</p></td></tr></table></div></div></div><p>这个方案非常适合作为一个新Web框架的起点 ——
                    免去了创建Servlet/Filter、初始化Spring容器、处理request/response等繁杂事务，并且完全支持SpringExt的所有功能，此外还包含了错误处理、开发模式等Webx
                    Framework中的一切便利。</p><p>另一种以Webx
                        Framework为基础的创建新框架的方法，是从pipeline入手。<span class="emphasis"><em>通过pipeline，理论上可以实现任何框架的功能</em></span>。</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="d0e421"><!--anchor d0e421--></a>1.2.2.4. 级别四：使用整个Webx框架，定制Turbine</h4></div></div></div><p>假如你想使用几乎大部分Webx的功能，但希望对少数步骤进行改进，你可以修改pipeline。</p><p>Webx Turbine本身定义了一套pipeline的实现，但是你完全可以去修改它：插入一些步骤、删除一些步骤、修改一些步骤 ——
                    所有都取决于你。</p><p>最常见的一个需求，是在Webx Turbine中添加权限验证 —— 只需要插入一个步骤就可以做到了。</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="d0e430"><!--anchor d0e430--></a>1.3. 本章总结</h2></div></div></div><p>Webx框架是一个稳定、强大的Web框架。倒不是说它实现了所有的功能，而是它建立在SpringExt的基础上，具有超强的扩展能力。你可以使用全部的Webx，也可以使用部分Webx。你也可以比较容易地用SpringExt做出自己的可扩展组件。</p></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pt01.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="pt01.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="springext.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">部分 I. Webx框架概览 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td><td width="40%" align="right" valign="top"> 第 2 章 SpringExt</td></tr></table></div></body></html>